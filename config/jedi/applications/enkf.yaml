# ObsAnchors and ObsErrorAnchors are automatically prepended above this line
_member: &memberConfig
  date: &analysisDate {{thisISO8601Date}}
  state variables: [{{StateVariables}}]
  stream name: background

_as observer: &asObserver
  run as observer only: true
  update obs config with geometry info: false

_as solver: &asSolver
  read HX from disk: true
  #do test prints: false
  do posterior observer: false
  save posterior ensemble: true
  save posterior mean: true

_as LETKF solver: &asLETKF
  solver: GSI LETKF

_as GETKF solver: &asGETKF
  solver: GETKF
  vertical localization: # only used by GETKF solver
    fraction of retained variance: {{fractionofvariance}}    
    lengthscale: {{verticalLocalizationLengthscale}}
    lengthscale units: modellevel

_letkf geometry: &3DLETKFGeometry
  iterator dimension: 3

_letkf geometry: &2DLETKFGeometry
  iterator dimension: 2

_lgetkf geometry: &3DGETKFGeometry
  iterator dimension: 2

geometry:
  <<: *{{localizationDimension}}{{localEnsembleDASolver}}Geometry
  nml_file: {{EnKFNamelistFile}}
  streams_file: {{EnKFStreamsFile}}
  deallocate non-da fields: true
  #interpolation type: unstructured # no Increment/State interp in enkf

window begin: {{windowBegin}}
window length: {{windowLength}}

background:
{{EnsembleMembers}}

increment variables: [{{AnalysisVariables}}]

observations:
  observers:
{{Observers}}

driver: *{{driver}}

local ensemble DA:
  <<: *{{LocalEnKFSolver}}
  inflation:
    rtps: {{rtps_value}}
    rtpp: {{rtpp_value}}
    mult: {{mult_value}}

output:
  filename: {{anStateDir}}/mem%{member}%/{{anStatePrefix}}.$Y-$M-$D_$h.$m.$s.nc
  stream name: analysis
