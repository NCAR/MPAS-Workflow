  obs filters:
  - filter: Domain Check
    where:
    - variable:
        name: MetaData/impact_height
      minvalue: 0.0
      maxvalue: 30000.0
    - variable:
        name: MetaData/earth_radius_of_curvature
      minvalue: 6250000.0
      maxvalue: 6450000.0
    - variable:
        name: MetaData/geoid_height_above_reference_ellipsoid
      minvalue: -200.0
      maxvalue: 200.0
  # reject where refractivity is assimilated
  # SPol
  - filter: RejectList
    defer to post: true
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: -90.0
      maxvalue: -60.0
    - variable:
        name: MetaData/impact_height
      maxvalue: *gnssroSPolTransition
  # SMid, Tro, NMid
  - filter: RejectList
    defer to post: true
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: -60.0
      maxvalue:  60.0
    - variable:
        name: MetaData/impact_height
      maxvalue: *gnssroSMidTroNMidTransition
  # NPol
  - filter: RejectList
    defer to post: true
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue:  60.0
      maxvalue:  90.0
    - variable:
        name: MetaData/impact_height
      maxvalue: *gnssroNPolTransition

  ## Scale ObsError based on ObsValue
  # NPol
  - filter: Perform Action
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: 60.0
      maxvalue: 90.0
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/impact_height
          scale_factor_var:
            name: ObsValue/bending_angle
          xvals: *gnssroErrorLevels
          errors: *gnssrobndmoNPolErrors
  # NMid
  - filter: Perform Action
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: 30.0
      maxvalue: 60.0
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/impact_height
          scale_factor_var:
            name: ObsValue/bending_angle
          xvals: *gnssroErrorLevels
          errors: *gnssrobndmoNMidErrors
  # Tro
  - filter: Perform Action
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: -30.0
      maxvalue:  30.0
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/impact_height
          scale_factor_var:
            name: ObsValue/bending_angle
          xvals: *gnssroErrorLevels
          errors: *gnssrobndmoTroErrors
  # SMid
  - filter: Perform Action
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: -60.0
      maxvalue: -30.0
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/impact_height
          scale_factor_var:
            name: ObsValue/bending_angle
          xvals: *gnssroErrorLevels
          errors: *gnssrobndmoSMidErrors
  # SPol
  - filter: Perform Action
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: -90.0
      maxvalue: -60.0
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/impact_height
          scale_factor_var:
            name: ObsValue/bending_angle
          xvals: *gnssroErrorLevels
          errors: *gnssrobndmoSPolErrors

  - filter: Background Check
    threshold: 3.0
    <<: *multiIterationFilter
