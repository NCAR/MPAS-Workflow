  obs filters:
  - filter: PreQC
    maxvalue: 3

  ## Specify ObsError (T, Tv, U, V) or scale ObsError based on ObsValue (qv only)
  # NXTro
  # T, Tv
  - filter: Perform Action
    filter variables:
    - name: air_temperature
    - name: virtual_temperature
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minNXTro
      maxvalue: *maxNXTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesNXTro_TError
  # U
  - filter: Perform Action
    filter variables:
    - name: eastward_wind
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minNXTro
      maxvalue: *maxNXTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesNXTro_UError
  # V
  - filter: Perform Action
    filter variables:
    - name: northward_wind
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minNXTro
      maxvalue: *maxNXTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesNXTro_VError
  # qv
  - filter: Perform Action
    filter variables:
    - name: specific_humidity
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minNXTro
      maxvalue: *maxNXTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          scale_factor_var:
            name: ObsValue/specific_humidity
          xvals: *sondesErrorLevels
          errors: *sondesNXTro_qvError

  # Tro
  # T, Tv
  - filter: Perform Action
    filter variables:
    - name: air_temperature
    - name: virtual_temperature
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minTro
      maxvalue: *maxTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesTro_TError
  # U
  - filter: Perform Action
    filter variables:
    - name: eastward_wind
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minTro
      maxvalue: *maxTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesTro_UError
  # V
  - filter: Perform Action
    filter variables:
    - name: northward_wind
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minTro
      maxvalue: *maxTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesTro_VError
  # qv
  - filter: Perform Action
    filter variables:
    - name: specific_humidity
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minTro
      maxvalue: *maxTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          scale_factor_var:
            name: ObsValue/specific_humidity
          xvals: *sondesErrorLevels
          errors: *sondesTro_qvError

  # SXTro
  # T, Tv
  - filter: Perform Action
    filter variables:
    - name: air_temperature
    - name: virtual_temperature
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minSXTro
      maxvalue: *maxSXTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesSXTro_TError
  # U
  - filter: Perform Action
    filter variables:
    - name: eastward_wind
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minSXTro
      maxvalue: *maxSXTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesSXTro_UError
  # V
  - filter: Perform Action
    filter variables:
    - name: northward_wind
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minSXTro
      maxvalue: *maxSXTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          xvals: *sondesErrorLevels
          errors: *sondesSXTro_VError
  # qv
  - filter: Perform Action
    filter variables:
    - name: specific_humidity
    where:
    - variable:
        name: MetaData/latitude
      minvalue: *minSXTro
      maxvalue: *maxSXTro
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/air_pressure
          scale_factor_var:
            name: ObsValue/specific_humidity
          xvals: *sondesErrorLevels
          errors: *sondesSXTro_qvError

  # avoids large ObsError values polluting plots of ObsError
  - filter: Bounds Check
    filter variables:
    - name: specific_humidity
    test variables:
    - name: specific_humidity@ObsErrorData
    minvalue: 0.0
    maxvalue: 1.0

  - filter: Background Check
    threshold: *sondesBGRelThresh
    <<: *multiIterationFilter
