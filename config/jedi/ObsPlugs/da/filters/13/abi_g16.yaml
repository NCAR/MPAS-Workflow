  obs filters:
  - filter: Domain Check
    where:
    - variable:
        name: MetaData/sensorZenithAngle
      maxvalue: 65.0
  - filter: Gaussian Thinning
    horizontal_mesh: {{RADTHINDISTANCE}}
  - filter: Domain Check
    filter variables:
    - name: brightnessTemperature
      channels: 13
    where:
    - variable:
        name: water_area_fraction@GeoVaLs
      minvalue: 1.0
    <<: *multiIterationFilter
  - filter: Perform Action
    <<: *multiIterationFilter
    filter variables:
    - name: brightnessTemperature
      channels: *abi_g16_channels
#  - filter: Domain Check
#    where:
#    - variable:
#        name: MetaData/cloudAmount
#      minvalue: 0.05
    action:
      name: assign error
      _symmetric cld fits 15X15-30km: &abi_g16_SymmCldFits15X15-30km
## 30 km, constant bias correction, first round of errors
#        x0: [1.0]
#        x1: [27.48]
#        err0: [0.87]
#        err1: [31.3]
        x0: [1.0]
        x1: [28.52]
        err0: [0.77]
        err1: [30.44]
      _symmetric cld fits 15X15-120km: &abi_g16_SymmCldFits15X15-120km
        <<: *abi_g16_SymmCldFits15X15-30km
      error function:
        name: ObsFunction/ObsErrorModelRamp
        channels: *abi_g16_channels
        options:
          <<: *abi_g16_SymmCldFits{{ABISUPEROBGRID}}-{{HofXMeshDescriptor}}
          channels: *abi_g16_channels
          xvar:
            name: ObsFunction/SymmCldImpactIR
            channels: *abi_g16_channels
            options:
              channels: *abi_g16_channels
  - filter: Background Check
    threshold: 3.0
    <<: *multiIterationFilter
## Ignore cloud-affected pixels in 1st iteration
#  - filter: Domain Check
#    <<: *multiIterationFilter
#    filter variables:
#    - name: brightnessTemperature
#      channels: *abi_g16_channels
#    where:
#    - variable:
##        name: MetaData/cloudAmount
#        name: ObsFunction/SymmCldImpactIR
#        channels: *abi_g16_channels
#        options:
#          channels: *abi_g16_channels
#      maxvalue: 0.01
#    action:
#      name: assign error
#      error parameter: 1000.0
  - filter: GOMsaver
    filename: {{OutDBDir}}{{MemberDir}}/{{geoPrefix}}_abi_g16.nc4
  - filter: YDIAGsaver
    filename: {{OutDBDir}}{{MemberDir}}/{{diagPrefix}}_abi_g16.nc4
    filter variables:
    - name: brightness_temperature_assuming_clear_sky
      channels: *abi_g16_channels
    - name: weightingfunction_of_atmosphere_layer
      channels: *abi_g16_channels
    - name: pressure_level_at_peak_of_weightingfunction
      channels: *abi_g16_channels
    - name: brightness_temperature_jacobian_air_temperature
      channels: *abi_g16_channels
    - name: brightness_temperature_jacobian_humidity_mixing_ratio
      channels: *abi_g16_channels
    - name: brightness_temperature_jacobian_surface_emissivity
      channels: *abi_g16_channels
    - name: brightness_temperature_jacobian_surface_temperature
      channels: *abi_g16_channels
