  obs filters:
  - filter: Domain Check
    where:
    - variable:
        name: MetaData/impact_height
      minvalue: 0.0
      maxvalue: 30000.0
    - variable:
        name: MetaData/earth_radius_of_curvature
      minvalue: 6250000.0
      maxvalue: 6450000.0
    - variable:
        name: MetaData/geoid_height_above_reference_ellipsoid
      minvalue: -200.0
      maxvalue: 200.0
      _error levels: &gnssrobndmoErrorLevels [0.000, 2500., 5000., 7500., 10000., 12500., 15000., 17500., 20000., 22500., 25000., 27500., 30000.]
      # based on RMS (bias included)
      _NXTro errors: &gnssrobndmoNXTroErrors [0.100, 0.130, 0.080, 0.040, 0.020, 0.019, 0.015, 0.014, 0.013, 0.012, 0.012, 0.013, 0.015]
      _Tro errors: &gnssrobndmoTroErrors     [0.100, 0.260, 0.150, 0.075, 0.025, 0.016, 0.017, 0.027, 0.024, 0.023, 0.022, 0.022, 0.022]
      _SXTro errors: &gnssrobndmoSXTroErrors [0.040, 0.150, 0.090, 0.040, 0.023, 0.023, 0.017, 0.017, 0.015, 0.016, 0.017, 0.019, 0.020]

      # based on STD (bias removed)
      #_NXTro errors: &gnssrobndmoNXTroErrors [0.100, 0.130, 0.080, 0.040, 0.020, 0.019, 0.015, 0.014, 0.013, 0.012, 0.012, 0.013, 0.014]
      #_Tro errors: &gnssrobndmoTroErrors     [0.100, 0.240, 0.150, 0.075, 0.025, 0.016, 0.017, 0.027, 0.024, 0.023, 0.020, 0.020, 0.020]
      #_SXTro errors: &gnssrobndmoSXTroErrors [0.040, 0.150, 0.090, 0.040, 0.023, 0.023, 0.017, 0.017, 0.015, 0.016, 0.017, 0.019, 0.020]

  #- filter: ROobserror
  #  filter variables:
  #  - name: bending_angle
  #  errmodel: ECMWF
  #  <<: *multiIterationFilter
  ## Scale ObsError based on ObsValue
  # NXTro
#  - filter: Perform Action
#    defer to post: true
#    filter variables:
#    - name: bending_angle
#    where:
#    - variable:
#        name: MetaData/latitude
#      minvalue: 30.0
#      maxvalue: 90.0
#    # reject where refractivity is assimilated
#    - variable:
#        name: MetaData/impact_height
#      minvalue: 0.0
#      maxvalue: 15000.0
#    action:
#      name: reject
  - filter: Perform Action
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: 30.0
      maxvalue: 90.0
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/impact_height
          scale_factor_var:
            name: ObsValue/bending_angle
          xvals: *gnssrobndmoErrorLevels
          errors: *gnssrobndmoNXTroErrors
  # Tro
#  - filter: Perform Action
#    defer to post: true
#    filter variables:
#    - name: bending_angle
#    where:
#    - variable:
#        name: MetaData/latitude
#      minvalue: -30.0
#      maxvalue:  30.0
#    # reject where refractivity is assimilated
#    - variable:
#        name: MetaData/impact_height
#      minvalue: 0.0
#      maxvalue: 15000.0
#    action:
#      name: reject
  - filter: Perform Action
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: -30.0
      maxvalue:  30.0
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/impact_height
          scale_factor_var:
            name: ObsValue/bending_angle
          xvals: *gnssrobndmoErrorLevels
          errors: *gnssrobndmoTroErrors
  # SXTro
#  - filter: Perform Action
#    defer to post: true
#    filter variables:
#    - name: bending_angle
#    where:
#    - variable:
#        name: MetaData/latitude
#      minvalue: -90.0
#      maxvalue: -30.0
#    # reject where refractivity is assimilated
#    - variable:
#        name: MetaData/impact_height
#      minvalue: 0.0
#      maxvalue: 15000.0
#    action:
#      name: reject
  - filter: Perform Action
    filter variables:
    - name: bending_angle
    where:
    - variable:
        name: MetaData/latitude
      minvalue: -90.0
      maxvalue: -30.0
    action:
      name: assign error
      error function:
        name: ObsFunction/ObsErrorModelStepwiseLinear
        options:
          xvar:
            name: MetaData/impact_height
          scale_factor_var:
            name: ObsValue/bending_angle
          xvals: *gnssrobndmoErrorLevels
          errors: *gnssrobndmoSXTroErrors

  - filter: Background Check
    threshold: 10.0
    <<: *multiIterationFilter
