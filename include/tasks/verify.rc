%include include/tasks/auto/extendedforecast.rc
%include include/tasks/auto/hofx.rc
%include include/tasks/auto/verifymodel.rc
%include include/tasks/auto/verifyobs.rc

## DA
  [[VerifyObsDA]]
    inherit = VerifyObsBase
    script = $origin/applications/VerifyObsDA.csh "1" "0" "DA" "0" "variational"
  [[CompareObsDA]]
    inherit = CompareBase
    script = $origin/applications/CompareObsDA.csh "1" "0" "DA" "variational"

## extended forecast from mean/deterministic state
  [[HofXMeanFC]]
    inherit = HofXBase
  [[VerifyModelMeanFC]]
    inherit = VerifyModelBase
  [[VerifyObsMeanFC]]
    inherit = VerifyObsBase
  [[CleanHofXMeanFC]]
    inherit = CleanBase
{% for dt in ExtendedFCLengths %}
  [[HofXMeanFC{{dt}}hr]]
    inherit = HofXMeanFC
    env-script = cd {{mainScriptDir}}; ./applications/PrepJEDIHofXMeanFC.csh "1" "{{dt}}" "FC" "hofx"
    script = $origin/applications/HofXMeanFC.csh "1" "{{dt}}" "FC"
  [[VerifyObsMeanFC{{dt}}hr]]
    inherit = VerifyObsMeanFC
    script = $origin/applications/VerifyObsMeanFC.csh "1" "{{dt}}" "FC" "0" "hofx"
  [[VerifyModelMeanFC{{dt}}hr]]
    inherit = VerifyModelMeanFC
    script = $origin/applications/VerifyModelMeanFC.csh "1" "{{dt}}" "FC" "0"
  [[CleanHofXMeanFC{{dt}}hr]]
    inherit = CleanHofXMeanFC
    script = $origin/applications/CleanHofXMeanFC.csh "1" "{{dt}}" "FC"
{% endfor %}


## ensemble mean background
  [[MeanBackground]]
    inherit = BATCH
    script = $origin/applications/MeanBackground.csh
    [[[job]]]
      execution time limit = PT5M
    [[[directives]]]
      -m = ae
      -q = {{NCPQueueName}}
      -A = {{NCPAccountNumber}}
      -l = select=1:ncpus=36:mpiprocs=36
  [[HofXEnsMeanBG]]
    inherit = HofXBase
    env-script = cd {{mainScriptDir}}; ./applications/PrepJEDIHofXEnsMeanBG.csh "1" "0" "BG" "hofx"
    script = $origin/applications/HofXEnsMeanBG.csh "1" "0" "BG"
    [[[directives]]]
      -q = {{EnsMeanBGQueueName}}
      -A = {{EnsMeanBGAccountNumber}}
  [[VerifyModelEnsMeanBG]]
    inherit = VerifyModelBase
    script = $origin/applications/VerifyModelEnsMeanBG.csh "1" "0" "BG" "{{nEnsSpreadMem}}"
    [[[job]]]
      execution time limit = PT{{modelEnsSeconds}}S
  [[VerifyObsEnsMeanBG]]
    inherit = VerifyObsBase
    script = $origin/applications/VerifyObsEnsMeanBG.csh "1" "0" "BG" "{{nEnsSpreadMem}}" "hofx"
    [[[job]]]
      execution time limit = PT{{obsEnsSeconds}}S
  [[CleanHofXEnsMeanBG]]
    inherit = CleanBase
    script = $origin/applications/CleanHofXEnsMeanBG.csh "1" "0" "BG"


## various kinds of ensembles
{% for state in ['BG', 'AN']%}
  [[HofX{{state}}]]
    inherit = HofXBase
  [[VerifyModel{{state}}]]
    inherit = VerifyModelBase
  [[CompareModel{{state}}]]
    inherit = CompareBase
  [[VerifyObs{{state}}]]
    inherit = VerifyObsBase
  [[CompareObs{{state}}]]
    inherit = CompareBase
  [[CleanHofX{{state}}]]
    inherit = CleanBase
{% endfor %}

{% for mem in EnsVerifyMembers %}
  # ensemble of backgrounds and analyses (including single-member deterministic)
  {% for state in ['BG', 'AN']%}
  [[HofX{{state}}{{mem}}]]
    inherit = HofX{{state}}
    env-script = cd {{mainScriptDir}}; ./applications/PrepJEDIHofX{{state}}.csh "{{mem}}" "0" "{{state}}" "hofx"
    script = $origin/applications/HofX{{state}}.csh "{{mem}}" "0" "{{state}}"
  [[VerifyModel{{state}}{{mem}}]]
    inherit = VerifyModel{{state}}
    script = $origin/applications/VerifyModel{{state}}.csh "{{mem}}" "0" "{{state}}" "0"
  [[CompareModel{{state}}{{mem}}]]
    inherit = CompareModel{{state}}
    script = $origin/applications/CompareModel{{state}}.csh "{{mem}}" "0" "{{state}}"
  [[VerifyObs{{state}}{{mem}}]]
    inherit = VerifyObs{{state}}
    script = $origin/applications/VerifyObs{{state}}.csh "{{mem}}" "0" "{{state}}" "0" "hofx"
  [[CompareObs{{state}}{{mem}}]]
    inherit = CompareObs{{state}}
    script = $origin/applications/CompareObs{{state}}.csh "{{mem}}" "0" "{{state}}" "hofx"
  [[CleanHofX{{state}}{{mem}}]]
    inherit = CleanHofX{{state}}
    script = $origin/applications/CleanHofX{{state}}.csh "{{mem}}" "0" "{{state}}"
  {% endfor %}
{% endfor %}

  [[HofXEnsFC]]
    inherit = HofXBase
  [[VerifyModelEnsFC]]
    inherit = VerifyModelBase
  [[VerifyObsEnsFC]]
    inherit = VerifyObsBase
  [[CleanHofXEnsFC]]
    inherit = CleanBase
{% for mem in EnsVerifyMembers %}
  # ensemble of extended forecasts from ensemble of analyses
  {% for dt in ExtendedFCLengths %}
  [[HofXEnsFC{{mem}}-{{dt}}hr]]
    inherit = HofXEnsFC
    env-script = cd {{mainScriptDir}}; ./applications/PrepJEDIHofXEnsFC.csh "{{mem}}" "{{dt}}" "FC" "hofx"
    script = $origin/applications/HofXEnsFC.csh "{{mem}}" "{{dt}}" "FC"
  [[VerifyModelEnsFC{{mem}}-{{dt}}hr]]
    inherit = VerifyModelEnsFC
    script = $origin/applications/VerifyModelEnsFC.csh "{{mem}}" "{{dt}}" "FC" "0"
  [[VerifyObsEnsFC{{mem}}-{{dt}}hr]]
    inherit = VerifyObsEnsFC
    script = $origin/applications/VerifyObsEnsFC.csh "{{mem}}" "{{dt}}" "FC" "0" "hofx"
  [[CleanHofXEnsFC{{mem}}-{{dt}}hr]]
    inherit = CleanHofXEnsFC
    script = $origin/applications/CleanHofXEnsFC.csh "{{mem}}" "{{dt}}" "FC"
  {% endfor %}
{% endfor %}
