# This is a basic workflow to help you get started with Actions

name: test-mpas-workflow

# Controls when the workflow will run
on:
  push:
    ## merges to develop branch
    branches: [develop]
  pull_request:
    # pull request to develop with a label
    types: [labeled]
    branches: [develop]

defaults:
  run:
    shell: bash

jobs:
  Run-mpas-workflow:
    if: ${{ github.event.label.name == 'run-cycle' }}
    runs-on: self-hosted
    steps:
      - name: checkout
        uses: actions/checkout@v3

      - name: run-mpas-workflow
        run: |
          source /etc/profile.d/modules.sh
          source ~/.bashrc
          export JEDI_OPT=/glade/work/jedipara/cheyenne/opt/modules
          module use $JEDI_OPT/modulefiles/core
          module load jedi/gnu-openmpi
          module list
          export MPASBUNDLECodeBuildDirectory=/glade/work/maryamao/nightly_build/MPAS/GNU/build_Nightly
          ls
          ls config
          pwd
          sed -i 's@^set\ commonBuild\ =\ .*@set\ commonBuild\ =\Â '${MPASBUNDLECodeBuildDirectory}'@' config/builds.csh 
          cat config/build.csh
          source env-setup/cheyenne.sh
          ./run.csh
