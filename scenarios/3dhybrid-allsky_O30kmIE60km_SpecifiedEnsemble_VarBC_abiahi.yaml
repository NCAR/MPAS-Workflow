# settings borrowed from /glade/work/liuz/pandac_hybrid/amsua_clrsky
experiment:
  name: 'abi_ch13_noH2O_bjobs_QC-230k_CA-15K_homogeneity_2.1_anotherTest1'

build:
  mpas bundle: /glade/campaign/mmm/parc/ivette/pandac/codeBuild/mpasBundle_2.1_varbc_CA_SP/build
#/glade/p/mmm/parc/ivette/pandac/codeBuild/mpasBundle_2.0_varbc_CA/build
#/glade/p/mmm/parc/ivette/pandac/codeBuild/mpasBundle_2.0_SP_T_jacobian/build

firstbackground:
  resource: "PANDAC.GFS"

hofx:
  job:
      retry: '3*PT30S'
initic:
  job:
      retry: '2*PT30S'
verifymodel:
  job:
      retry: '3*PT30S'
verifyobs:
    defaults:
      retry: '3*PT30S'

forecast:
  job:
    defaults:
      retry: '3*PT30S'
  #  30km:
  #    nodes: 8
  #    PEPerNode: 36
  #    baseSeconds: 60
  #    secondsPerForecastHR: 80

  #execute: False # the default is True
  #post: [verifyobs] # use this when doing extended forecast
  post: [verifyobs,verifymodel] # this turns off verifyobs,verifymodel
  #post: []

externalanalyses:
  resource: "GFS.PANDAC"
  resources:
    GFS:
      PANDAC: # only available 20180418T00-20180524T00
        30km:
          directory: "/glade/campaign/mmm/parc/liuz/pandac_common/fixed_input/30km/GFSAnaAndDiagnostics"
members:
  n: 1

model:
  outerMesh: 30km
  innerMesh: 60km
  ensembleMesh: 60km

observations:
  resource: PANDACArchiveForVarBC
  resources:
    PANDACArchiveForVarBC:
      instrumentsAllowingBiasCorrection:
      - amsua_aqua
      - amsua_metop-a
      - amsua_metop-b
      - amsua_metop-c
      - amsua_n15
      - amsua_n18
      - amsua_n19
      - mhs_metop-a
      - mhs_metop-b
      - mhs_n18
      - mhs_n19
      #- ahi_himawari8
      #- abi_g16
      #- abi-clr_g16
      #- ahi-clr_himawari8
      IODADirectory:
        da:
          ## abi
          abi_g16: /glade/campaign/mmm/parc/ivette/pandac/Observations/abi/bj_so_abi/v3_nc_renamed
          #abi_g16: /glade/p/mmm/parc/liuz/pandac_common/obs/ioda_v3/2018/ABIASR/IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          #IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          #IODANC_THIN15KM_SUPEROB15X15_const-bias-correct
          ## ahi
          ahi_himawari8: /glade/campaign/mmm/parc/liuz/pandac_common/obs/ioda_v3/2018/AHIASR/IODANC_SUPEROB15X15_no-bias-correct
          #IODANC_SUPEROB15X15_no-bias-correct
          #IODANC_SUPEROB15X15_const-bias-correct
          
          abi-clr_g16: /glade/campaign/mmm/parc/liuz/pandac_common/obs/ioda_v3/2018/ABIASR/IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          #IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          #IODANC_THIN15KM_SUPEROB15X15_const-bias-correct
          ## ahi
          ahi-clr_himawari8: /glade/campaign/mmm/parc/liuz/pandac_common/obs/ioda_v3/2018/AHIASR/IODANC_SUPEROB15X15_no-bias-correct
        hofx:
          ## abi
          abi_g16: /glade/campaign/mmm/parc/ivette/pandac/Observations/abi/bj_so_abi/v3_nc_renamed
          #abi_g16: /glade/p/mmm/parc/liuz/pandac_common/obs/ioda_v3/2018/ABIASR/IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          #IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          #IODANC_THIN15KM_SUPEROB15X15_const-bias-correct
          ## ahi
          ahi_himawari8: /glade/campaign/mmm/parc/liuz/pandac_common/obs/ioda_v3/2018/AHIASR/IODANC_SUPEROB15X15_no-bias-correct
          #IODANC_SUPEROB15X15_no-bias-correct
          #IODANC_SUPEROB15X15_const-bias-correct
          
          abi-clr_g16: /glade/campaign/mmm/parc/liuz/pandac_common/obs/ioda_v3/2018/ABIASR/IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          #IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          #IODANC_THIN15KM_SUPEROB15X15_const-bias-correct
          ## ahi
          ahi-clr_himawari8: /glade/campaign/mmm/parc/liuz/pandac_common/obs/ioda_v3/2018/AHIASR/IODANC_SUPEROB15X15_no-bias-correct
      IODASuperObGrid:
        abi_g16: 15X15
        ahi_himawari8: 15X15

variational:
  DAType: 3dhybrid-allsky
  biasCorrection: True
  nInnerIterations: [60,60,]
  ensemble:
    forecasts:
      resource: "PANDAC.EDA"
  observers: [
    aircraft,
    gnssrobndropp1d,
    satwind,
    satwnd,
    sfc,
    sondes,
    amsua_aqua,
    amsua_metop-a,
    amsua_metop-b,
    amsua_n15,
    amsua_n18,
    amsua_n19,
    mhs_metop-a,
    mhs_metop-b,
    mhs_n18,
    mhs_n19,
    abi_g16,
    #ahi_himawari8,
    #abi-clr_g16,
    #ahi-clr_himawari8,
  ]

  # resource requirements
  job:
    defaults:
      retry: '3*PT30S'
    30km:
      60km:
        3dhybrid-allsky:
          nodes: 4 #6 #8
          PEPerNode: 64 #32 #24
          memory: 235 #109GB #45GB
          baseSeconds: 2000
          secondsPerEnVarMember: 8

  #execute: False # the default is True
  #post: []
  post: [verifyobs] # this turns off verifyobs

workflow:
  first cycle point: 20180414T18
  #restart cycle point: 20180415T00
  final cycle point: 20180415T00
  #final cycle point: 20180514T18
  #CyclingWindowHR: 24 # default is 6 for cycling DA
  #max active cycle points: 4 # used for independent 'extendedforecast'
hpc:
  CriticalQueue: economy
  NonCriticalQueue: economy
#  CriticalAccount:
#  NonCriticalAccount:
