####################################################################################################
workflow:
#############
# date bounds
#############
## firstCyclePoint
# initial date of this experiment
# OPTIONS:
#   + 20180414T18
#   + 20200722T18
#   + any other date for ColdStart
  firstCyclePoint: 20180414T18

## initialCyclePoint
# OPTIONS: >= FirstCycleDate (see config/experiment.csh)
# Either:
# + initialCyclePoint must be equal to FirstCycleDate
# OR:
# + CyclingFC must have been completed for the cycle before initialCyclePoint. Set > FirstCycleDate to automatically restart
#   from a previously completed cycle.
  initialCyclePoint: 20180414T18

## finalCyclePoint
# OPTIONS: >= initialCyclePoint
# + ancillary model and/or observation data must be available between initialCyclePoint and finalCyclePoint
  finalCyclePoint: 20180514T18

################
# task selection
################
## InitializationType
# Indicates the type of initialization at the initial cycle: cold or warm start
# OPTIONS:
#   ColdStart - generate first forecast online from an external GFS analysis
#   WarmStart - copy a pre-generated forecast
  InitializationType: WarmStart

## PreprocessObs
# Whether to convert RDA archived BUFR observations to IODA on the fly (True)
# or use pre-converted observation files, the latter only being available for
# specific time periods
# OPTIONS: True/False
  PreprocessObs: False

## CriticalPathType: controls dependencies between and chilrdren of
#                   DA and FC cycling components
# OPTIONS: Normal, Bypass, Reanalysis, Reforecast
  CriticalPathType: Normal

## VerifyDeterministicDA: whether to run verification scripts for
#    obs feedback files from DA.  Does not work for ensemble DA.
#    Only works when CriticalPathType == Normal.
# OPTIONS: True/False
  VerifyDeterministicDA: True

## CompareDA2Benchmark: compare verification nc files between two experiments
#    after the DA verification completes
# OPTIONS: True/False
  CompareDA2Benchmark: False

## VerifyExtendedMeanFC: whether to run verification scripts across
#    extended forecast states, first intialized at mean analysis
# OPTIONS: True/False
  VerifyExtendedMeanFC: False

## VerifyBGMembers: whether to run verification scripts for CyclingWindowHR
#    forecast length. Runs HofXBG, VerifyObsBG, and VerifyModelBG on critical
#    path forecasts that are initialized from ensemble member analyses.
# OPTIONS: True/False
  VerifyBGMembers: False

## CompareBG2Benchmark: compare verification nc files between two experiments
#    after the BGMembers verification completes
# OPTIONS: True/False
  CompareBG2Benchmark: False

## VerifyEnsMeanBG: whether to run verification scripts for ensemble mean
#    background (nEnsDAMembers > 1) or deterministic background (nEnsDAMembers == 1)
# OPTIONS: True/False
  VerifyEnsMeanBG: True

## DiagnoseEnsSpreadBG: whether to diagnose the ensemble spread in observation
#    space while VerifyEnsMeanBG is True.  Automatically triggers HofXBG
#    for all ensemble members.
# OPTIONS: True/False
  DiagnoseEnsSpreadBG: True

## VerifyEnsMeanAN: whether to run verification scripts for ensemble
#    mean analysis state.
# OPTIONS: True/False
  VerifyANMembers: False

## VerifyExtendedEnsBG: whether to run verification scripts across
#    extended forecast states, first intialized at ensemble of analysis
#    states.
# OPTIONS: True/False
  VerifyExtendedEnsFC: False

####################################################################################################
experiment:
#TODO: move model-, obs-, variational-, hofx-specific settings under their own headers
# outside of the "experiment" header

## ExpSuffix
# a unique suffix to distinguish this experiment from others
  ExpSuffix: ''

## ExperimentName
# allows for manually overriding the ExperimentName instead of auto-generating it from the config
# Note: when using with run.csh and for multiple simultaneously running scenarios, either
# all scenarios must have ExperimentName specified explicitly or else ExperimentName must be empty
  ExperimentName: ''

#######
# model
#######
## MPASGridDescriptor
# used to distinguish betwen MPAS meshes across experiments
# O = variational Outer loop, forecast, HofX
# I = variational Inner loop
# E = variational Ensemble
# OPTIONS:
#   + OIE120km -- 3dvar, 3denvar, eda_3denvar
#   + O30kmIE120km -- dual-resolution 3denvar
#   + OIE60km -- eda_3denvar only
#   + TODO: OIE60km -- 3denvar, requires generating MPASSeaVariables update files from GFS analyses
#   + O30kmIE60km -- dual-resolution 3denvar
#   + TODO: "OIE30km" 3denvar
#   + TODO: "O30kmIE60km" dual-resolution eda_3denvar with 60km ensemble, 30km deterministic
#   + TODO: "OE30kmI60km" dual-resolution eda_3denvar with 30km ensemble, no deterministic?
#   + TODO: "OIE120km" 4denvar
#   + TODO: "OIE60km" 4denvar
#   + TODO: "O30kmIE60km" dual-resolution 4denvar
  MPASGridDescriptor: None

#####
# obs
#####
## preprocessObsList
# list of raw observation types to convert to IODA
  preprocessObsList:
  - prepbufr
  - satwnd
  - satwind
  - 1bamua
  #- gpsro
  #- 1bmhs
  #- airsev
  #- cris
  #- mtiasi

#############
# variational
#############
## DAType
# OPTIONS: 3dvar, 3denvar, eda_3denvar
# Note: 3dvar currently only works for OIE120km
  DAType: None

## nInnerIterations
# list of inner iteration counts across all outer iterations
  nInnerIterations: [60,]

## fixedEnsBType
# selection of data source for fixed ensemble background covariance members when EDASize==nDAInstances==1
# OPTIONS: GEFS (default), PreviousEDA
  fixedEnsBType: GEFS

# tertiary settings that only apply when fixedEnsBType is set to PreviousEDA
  nPreviousEnsDAMembers: 20
  PreviousEDAForecastDir: /glade/scratch/guerrett/pandac/guerrett_eda_3denvar_NMEM${nPreviousEnsDAMembers}_RTPP0.80_LeaveOneOut_OIE120km_memberSpecificTemplate_GEFSSeaUpdate/CyclingFC

## EDASize and nDAInstances
# ensemble size of each DA instance
# OPTIONS:
#   1: ensemble of nDAInstances independent Variational applications (nEnsDAMembers jobs), each
#      with 1 background state member per DA job
# > 1: ensemble of nDAInstances independent EnsembleOfVariational applications, each with EDASize
#      background state members per DA job
# In both cases, nEnsDAMembers=(EDASize * nDAInstances) forecasts are used for the flow-dependent
# background error
  EDASize: 1
  nDAInstances: 1

## LeaveOneOutEDA, whether to use self-exclusion in the EnVar ensemble B during EDA cycling
# OPTIONS: True/False
  LeaveOneOutEDA: True

## RTPPInflationFactor
# relaxation parameter for the relaxation to prior perturbation (RTPP) inflation mechanism; only
# applies to EDA cycling
# Typical Values: 0.0 or 0.50 to 0.90
  RTPPInflationFactor: 0.80

## storeOriginalRTPPAnalyses
# whether to keep/store the analyses taken as inputs to RTPP for diagnostic purposes
# OPTIONS: True/False
  storeOriginalRTPPAnalyses: False

## ABEIInflation
# whether to utilize adaptive background error inflation (ABEI) in cloud-affected scenes
# as measured by ABI and AHI observations
# OPTIONS: True/False
  ABEInflation: False

## ABEIChannel
# ABI and AHI channel used to determine the inflation factor
# OPTIONS: 8, 9, 10
  ABEIChannel: 8

## benchmarkObsList
# base set of observation types assimilated in all experiments
  benchmarkObsList:
  - sondes
  - aircraft
  - satwind
  - gnssroref
  - sfc
  - amsua_n19
  - amsua_n18
  - amsua_n15
  - amsua_aqua
  - amsua_metop-a
  - amsua_metop-b

######
# hofx
######
## hofxObsList
# observation types simulated in hofx application instances for verification
# OPTIONS: see list below
# Abbreviations:
#   clr == clear-sky
#   cld == cloudy-sky
  hofxObsList:
  - sondes
  - aircraft
  - satwind
  - gnssroref
  - sfc
  - amsua_n19
  - amsua_n18
  - amsua_n15
  - amsua_aqua
  - amsua_metop-a
  - amsua_metop-b
  - amsua-cld_n19
  - amsua-cld_n18
  - amsua-cld_n15
  - amsua-cld_aqua
  - amsua-cld_metop-a
  - amsua-cld_metop-b
  - mhs_n19
  - mhs_n18
  - mhs_metop-a
  - mhs_metop-b
  - abi_g16
  - ahi_himawari8
  #- abi-clr_g16
  #- ahi-clr_himawari8

job:
## *AccountNumber
# OPTIONS: NMMM0015, NMMM0043
#Note: NMMM0043 is not available on casper

## *QueueName
# Cheyenne Options: economy, regular, premium
# Casper Options: casper@casper-pbs

# CP*: used for all critical path jobs, single or multi-node, multi-processor only
  CPAccountNumber: NMMM0043
  CPQueueName: regular

# NCP*: used non-critical path jobs, single or multi-node, multi-processor only
  NCPAccountNumber: NMMM0043
  NCPQueueName: economy

# EnsMeanBG*: settings for ensemble mean BG calculation, useful when it becomes time-critical
  EnsMeanBGAccountNumber: NMMM0043
  EnsMeanBGQueueName: economy

# SingleProc*: used for single-processor jobs, both critical and non-critical paths
# IMPORTANT: must NOT be executed on login node to comply with CISL requirements
  #SingleProcAccountNumber: NMMM0043
  #SingleProcQueueName: share
  SingleProcAccountNumber: NMMM0015
  SingleProcQueueName: "casper@casper-pbs"

## *Retry
# various retry counts for different types of tasks
  InitializationRetry: '2*PT30S'
  VariationalRetry: '2*PT30S'
  EnsOfVariationalRetry: '1*PT30S'
  CyclingFCRetry: '2*PT30S'
  RTPPInflationRetry: '2*PT30S'
  HofXRetry: '2*PT30S'
  VerifyObsRetry: '1*PT30S'
  VerifyModelRetry: '1*PT30S'
