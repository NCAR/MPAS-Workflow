####################################################################################################
workflow:
#############
# date bounds
#############
## firstCyclePoint
# initial date of this experiment
# OPTIONS:
#   + 20180414T18
#   + 20200722T18
#   + any other date for ColdStart
  firstCyclePoint: 20180414T18

## initialCyclePoint
# OPTIONS: >= FirstCycleDate (see config/experiment.csh)
# Either:
# + initialCyclePoint must be equal to FirstCycleDate
# OR:
# + CyclingFC must have been completed for the cycle before initialCyclePoint. Set > FirstCycleDate
#   to automatically restart from a previously completed cycle.
  initialCyclePoint: 20180414T18

## finalCyclePoint
# OPTIONS: >= initialCyclePoint
# + ancillary model and/or observation data must be available between initialCyclePoint and
#   finalCyclePoint
  finalCyclePoint: 20180514T18

################
# task selection
################
## InitializationType
# Indicates the type of initialization at the initial cycle: cold or warm start
# OPTIONS:
#   ColdStart - generate first forecast online from an external GFS analysis
#   WarmStart - copy a pre-generated forecast
  InitializationType: WarmStart

## CriticalPathType: controls dependencies between and chilrdren of
#                   DA and FC cycling components
# OPTIONS: Normal, Bypass, Reanalysis, Reforecast
  CriticalPathType: Normal

## VerifyDeterministicDA: whether to run verification scripts for
#    obs feedback files from DA.  Does not work for ensemble DA.
#    Only works when CriticalPathType == Normal.
# OPTIONS: True/False
  VerifyDeterministicDA: True

## CompareDA2Benchmark: compare verification nc files between two experiments
#    after the DA verification completes
# OPTIONS: True/False
  CompareDA2Benchmark: False

## VerifyExtendedMeanFC: whether to run verification scripts across
#    extended forecast states, first intialized at mean analysis
# OPTIONS: True/False
  VerifyExtendedMeanFC: False

## VerifyBGMembers: whether to run verification scripts for CyclingWindowHR
#    forecast length. Runs HofXBG, VerifyObsBG, and VerifyModelBG on critical
#    path forecasts that are initialized from ensemble member analyses.
# OPTIONS: True/False
  VerifyBGMembers: False

## CompareBG2Benchmark: compare verification nc files between two experiments
#    after the BGMembers verification completes
# OPTIONS: True/False
  CompareBG2Benchmark: False

## VerifyEnsMeanBG: whether to run verification scripts for ensemble mean
#    background (nEnsDAMembers > 1) or deterministic background (nEnsDAMembers == 1)
# OPTIONS: True/False
  VerifyEnsMeanBG: True

## DiagnoseEnsSpreadBG: whether to diagnose the ensemble spread in observation
#    space while VerifyEnsMeanBG is True.  Automatically triggers HofXBG
#    for all ensemble members.
# OPTIONS: True/False
  DiagnoseEnsSpreadBG: True

## VerifyEnsMeanAN: whether to run verification scripts for ensemble
#    mean analysis state.
# OPTIONS: True/False
  VerifyANMembers: False

## VerifyExtendedEnsBG: whether to run verification scripts across
#    extended forecast states, first intialized at ensemble of analysis
#    states.
# OPTIONS: True/False
  VerifyExtendedEnsFC: False

##################################
## analysis and forecast intervals
##################################
#TODO: move these settings to scenario.workflow yaml section
  # forecast interval between CyclingDA analyses
  CyclingWindowHR: 6

  # length of verification forecasts
  ExtendedFCWindowHR: 240

  # interval between OMF verification times of an individual forecast
  ExtendedFC_DT_HR: 12

  # times of the day to run extended forecast from mean analysis
  ExtendedMeanFCTimes: T00,T12

  # times of the day to run ensemble of extended forecasts
  ExtendedEnsFCTimes: T00

  # window of observations included in AN/BG verification
  DAVFWindowHR: 6

  # window of observations included in forecast verification
  FCVFWindowHR: 6

####################################################################################################
experiment:
## ExpSuffix
# a unique suffix to distinguish this experiment from others
  ExpSuffix: ''

## ExperimentName
# leave as DEFAULT to be automatically generated from critical config elements
# Note: when using with run.csh and for multiple simultaneously running scenarios, setting
# ExperimentName explicitly for all scenarios is the safest way to ensure that two scenarios do not
# have identically auto-generated ExperimentName's
  ExperimentName: DEFAULT

## ParentDirectory will be constructd using
# set ParentDirectory = ${ParentDirectoryPrefix}/${ExperimentUser}/${ParentDirectorySuffix}

## ParentDirectoryPrefix
  ParentDirectoryPrefix: /glade/scratch

## ExperimentUser
# leave as DEFAULT to be assigned with 'set ExperimentUser = ${USER}'
  ExperimentUser: DEFAULT

## ParentDirectorySuffix
  ParentDirectorySuffix: pandac


####################################################################################################
observations:
## observationSource
# OPTIONS: PANDACArchive, GladeRDAOnline
# Note: add more options as they become available, e.g., NCEPFTPOnline
  observationSource: PANDACArchive

## convertToIODAObservations
# list of raw observation types to convert to IODA format, when (observationSource != PANDACArchive)
  convertToIODAObservations:
  - prepbufr
  - satwnd
  - satwind
  - 1bamua
  #- gpsro
  #- 1bmhs
  #- airsev
  #- cris
  #- mtiasi

## *Directory
# locations of raw bufr and prepbufr observation data, separated by observationSource
  GladeRDAOnline:
    defaultBUFRDirectory: /gpfs/fs1/collections/rda/data/ds735.0
    satwndBUFRDirectory: /gpfs/fs1/collections/rda/data/ds351.0
    PrepBUFRDirectory: /gpfs/fs1/collections/rda/data/ds337.0

    IODADirectory:
      variational:
        ## anchor
        aircraft:
          directory: __ObsWorkDir__
        gnssroref:
          directory: __ObsWorkDir__
          prefix: gnssro
        satwind:
          directory: __ObsWorkDir__
        satwnd:
          directory: __ObsWorkDir__
        sfc:
          directory: __ObsWorkDir__
        sondes:
          directory: __ObsWorkDir__

        ## amsua
        amsua_aqua:
          directory: __ObsWorkDir__
        amsua_metop-a:
          directory: __ObsWorkDir__
        amsua_metop-b:
          directory: __ObsWorkDir__
        amsua_n15:
          directory: __ObsWorkDir__
        amsua_n18:
          directory: __ObsWorkDir__
        amsua_n19:
          directory: __ObsWorkDir__
        amsua-cld_aqua:
          directory: __ObsWorkDir__
          prefix: amsua_aqua
        amsua-cld_metop-a:
          directory: __ObsWorkDir__
          prefix: amsua_metop-a
        amsua-cld_metop-b:
          directory: __ObsWorkDir__
          prefix: amsua_metop-b
        amsua-cld_n15:
          directory: __ObsWorkDir__
          prefix: amsua_n15
        amsua-cld_n18:
          directory: __ObsWorkDir__
          prefix: amsua_n18
        amsua-cld_n19:
          directory: __ObsWorkDir__
          prefix: amsua_n19

        ## mhs
        mhs_metop-a:
          directory: __ObsWorkDir__
        mhs_metop-b:
          directory: __ObsWorkDir__
        mhs_n18:
          directory: __ObsWorkDir__
        mhs_n19:
          directory: __ObsWorkDir__

      hofx:
        ##anchor
        aircraft:
          directory: __ObsWorkDir__
        gnssroref:
          directory: __ObsWorkDir__
          prefix: gnssro
        satwind:
          directory: __ObsWorkDir__
        satwnd:
          directory: __ObsWorkDir__
        sfc:
          directory: __ObsWorkDir__
        sondes:
          directory: __ObsWorkDir__

        ## amsua
        amsua_aqua:
          directory: __ObsWorkDir__
        amsua_metop-a:
          directory: __ObsWorkDir__
        amsua_metop-b:
          directory: __ObsWorkDir__
        amsua_n15:
          directory: __ObsWorkDir__
        amsua_n18:
          directory: __ObsWorkDir__
        amsua_n19:
          directory: __ObsWorkDir__
        amsua-cld_aqua:
          directory: __ObsWorkDir__
          prefix: amsua_aqua
        amsua-cld_metop-a:
          directory: __ObsWorkDir__
          prefix: amsua_metop-a
        amsua-cld_metop-b:
          directory: __ObsWorkDir__
          prefix: amsua_metop-b
        amsua-cld_n15:
          directory: __ObsWorkDir__
          prefix: amsua_n15
        amsua-cld_n18:
          directory: __ObsWorkDir__
          prefix: amsua_n18
        amsua-cld_n19:
          directory: __ObsWorkDir__
          prefix: amsua_n19

        ## mhs
        mhs_metop-a:
          directory: __ObsWorkDir__
        mhs_metop-b:
          directory: __ObsWorkDir__
        mhs_n18:
          directory: __ObsWorkDir__
        mhs_n19:
          directory: __ObsWorkDir__

  PANDACArchive:
    IODADirectory:
      variational:
        ##anchor
        aircraft:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs
        gnssroref:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs
          prefix: gnssro
        satwind:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs
        sfc:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs
        sondes:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs

        ## amsua
        amsua_aqua:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        amsua_metop-a:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        amsua_metop-b:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        amsua_n15:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        amsua_n18:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        amsua_n19:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        amsua-cld_aqua:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
          prefix: amsua_aqua
        amsua-cld_metop-a:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
          prefix: amsua_metop-a
        amsua-cld_metop-b:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
          prefix: amsua_metop-b
        amsua-cld_n15:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
          prefix: amsua_n15
        amsua-cld_n18:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
          prefix: amsua_n18
        amsua-cld_n19:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
          prefix: amsua_n19

        ## mhs
        mhs_metop-a:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        mhs_metop-b:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        mhs_n18:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr
        mhs_n19:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/bias_corr

        ## abi
        abi_g16:
          #directory: /glade/work/guerrett/pandac/obs/ABIASR/ioda-v2/IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          directory: /glade/work/guerrett/pandac/obs/ABIASR/ioda-v2/IODANC_THIN15KM_SUPEROB59X59_no-bias-correct
          superObGrid: 59X59
        abi-clr_g16:
          #directory: /glade/work/guerrett/pandac/obs/ABIASR/ioda-v2/IODANC_THIN15KM_SUPERO15X15_no-bias-correct
          directory: /glade/work/guerrett/pandac/obs/ABIASR/ioda-v2/IODANC_THIN15KM_SUPERO59X59_no-bias-correct
          prefix: abi_g16

        ## ahi
        ahi_himawari8:
          #directory: /glade/work/guerrett/pandac/obs/AHIASR/ioda-v2/IODANC_SUPEROB15X15_no-bias-correct
          directory: /glade/work/guerrett/pandac/obs/AHIASR/ioda-v2/IODANC_SUPEROB101X101_no-bias-correct
          superObGrid: 101X101
        ahi-clr_himawari8:
          #directory: /glade/work/guerrett/pandac/obs/AHIASR/ioda-v2/IODANC_SUPEROB15X15_no-bias-correct
          directory: /glade/work/guerrett/pandac/obs/AHIASR/ioda-v2/IODANC_SUPEROB101X101_no-bias-correct
          prefix: ahi_himawari8

      hofx:
        ## anchor
        aircraft:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs
        gnssroref:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs
          prefix: gnssro
        satwind:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs
        sfc:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs
        sondes:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/conv_obs

        ## amsua
        amsua_aqua:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        amsua_metop-a:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        amsua_metop-b:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        amsua_n15:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        amsua_n18:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        amsua_n19:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        amsua-cld_aqua:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
          prefix: amsua_aqua
        amsua-cld_metop-a:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
          prefix: amsua_metop-a
        amsua-cld_metop-b:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
          prefix: amsua_metop-b
        amsua-cld_n15:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
          prefix: amsua_n15
        amsua-cld_n18:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
          prefix: amsua_n18
        amsua-cld_n19:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
          prefix: amsua_n19

        ## mhs
        mhs_metop-a:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        mhs_metop-b:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        mhs_n18:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias
        mhs_n19:
          directory: /glade/p/mmm/parc/liuz/pandac_common/newobs_2018/no_bias

        ## abi
        abi_g16:
          #directory: /glade/work/guerrett/pandac/obs/ABIASR/ioda-v2/IODANC_THIN15KM_SUPEROB15X15_no-bias-correct
          directory: /glade/work/guerrett/pandac/obs/ABIASR/ioda-v2/IODANC_THIN15KM_SUPEROB59X59_no-bias-correct
          superObGrid: 59X59
        abi-clr_g16:
          #directory: /glade/work/guerrett/pandac/obs/ABIASR/ioda-v2/IODANC_THIN15KM_SUPERO15X15_no-bias-correct
          directory: /glade/work/guerrett/pandac/obs/ABIASR/ioda-v2/IODANC_THIN15KM_SUPERO59X59_no-bias-correct
          prefix: abi_g16

        ## ahi
        ahi_himawari8:
          #directory: /glade/work/guerrett/pandac/obs/AHIASR/ioda-v2/IODANC_SUPEROB15X15_no-bias-correct
          directory: /glade/work/guerrett/pandac/obs/AHIASR/ioda-v2/IODANC_SUPEROB101X101_no-bias-correct
          superObGrid: 101X101
        ahi-clr_himawari8:
          #directory: /glade/work/guerrett/pandac/obs/AHIASR/ioda-v2/IODANC_SUPEROB15X15_no-bias-correct
          directory: /glade/work/guerrett/pandac/obs/AHIASR/ioda-v2/IODANC_SUPEROB101X101_no-bias-correct
          prefix: ahi_himawari8

####################################################################################################
model:
#######
# model
#######
## MPASGridDescriptor [Required Parameter]
# used to distinguish betwen MPAS meshes across experiments
# O = variational Outer loop, forecast, HofX
# I = variational Inner loop
# E = variational Ensemble
# OPTIONS:
#   + OIE120km -- 3dvar, 3denvar, eda_3denvar
#   + O30kmIE120km -- dual-resolution 3denvar
#   + OIE60km -- eda_3denvar only
#   + TODO: OIE60km -- 3denvar, requires generating MPASSeaVariables update files from GFS analyses
#   + O30kmIE60km -- dual-resolution 3denvar
#   + TODO: "OIE30km" 3denvar
#   + TODO: "O30kmIE60km" dual-resolution eda_3denvar with 60km ensemble, 30km deterministic
#   + TODO: "OE30kmI60km" dual-resolution eda_3denvar with 30km ensemble, no deterministic?
#   + TODO: "OIE120km" 4denvar
#   + TODO: "OIE60km" 4denvar
#   + TODO: "O30kmIE60km" dual-resolution 4denvar
  MPASGridDescriptor: None

## forecastPrecision
# floating-point precision of forecast output; options: [single, double]
  forecastPrecision: single

####################################################################################################
hofx:
## observations
# observation types simulated in hofx application instances for verification
# OPTIONS: see list below
# Abbreviations:
#   clr == clear-sky
#   cld == cloudy-sky
  observations:
# anchor
  - aircraft
  - gnssroref
  - satwind
#TODO: add satwnd, used in ColdStart and will not break WarmStart
# - satwnd
  - sfc
  - sondes
# MW satellite-based
  - amsua_aqua
  - amsua_metop-a
  - amsua_metop-b
  - amsua_n15
  - amsua_n18
  - amsua_n19
  - amsua-cld_aqua
  - amsua-cld_metop-a
  - amsua-cld_metop-b
  - amsua-cld_n15
  - amsua-cld_n18
  - amsua-cld_n19
  - mhs_n19
  - mhs_n18
  - mhs_metop-a
  - mhs_metop-b
# IR satellite-based
  - abi_g16
  - ahi_himawari8
  #- abi-clr_g16
  #- ahi-clr_himawari8

## nObsIndent
# number of spaces to precede members of the 'observations' list in the JEDI YAML
  nObsIndent: 0

####################################################################################################
variational:
## DAType [Required Parameter]
# OPTIONS: 3dvar, 3denvar, eda_3denvar
# Note: 3dvar currently only works for OIE120km
  DAType: None

## nInnerIterations
# list of inner iteration counts across all outer iterations
  nInnerIterations: [60,]

## fixedEnsBType
# selection of data source for fixed ensemble background covariance members when
# EDASize==nDAInstances==1
# OPTIONS: GEFS (default), PreviousEDA
  fixedEnsBType: GEFS

# tertiary settings that only apply when fixedEnsBType is set to PreviousEDA
  nPreviousEnsDAMembers: 20
  PreviousEDAForecastDir: /glade/scratch/guerrett/pandac/guerrett_eda_3denvar_NMEM${nPreviousEnsDAMembers}_RTPP0.80_LeaveOneOut_OIE120km_memberSpecificTemplate_GEFSSeaUpdate/CyclingFC

## EDASize and nDAInstances
# ensemble size of each DA instance
# OPTIONS:
#   1: ensemble of nDAInstances independent Variational applications (nEnsDAMembers jobs), each
#      with 1 background state member per DA job
# > 1: ensemble of nDAInstances independent EnsembleOfVariational applications, each with EDASize
#      background state members per DA job
# In both cases, nEnsDAMembers=(EDASize * nDAInstances) forecasts are used for the flow-dependent
# background error
  EDASize: 1
  nDAInstances: 1

## LeaveOneOutEDA, whether to use self-exclusion in the EnVar ensemble B during EDA cycling
# OPTIONS: True/False
  LeaveOneOutEDA: True

## RTPPInflationFactor
# relaxation parameter for the relaxation to prior perturbation (RTPP) inflation mechanism; only
# applies to EDA cycling
# Typical Values: 0.0 or 0.50 to 0.90
  RTPPInflationFactor: 0.80

## storeOriginalRTPPAnalyses
# whether to keep/store the analyses taken as inputs to RTPP for diagnostic purposes
# OPTIONS: True/False
  storeOriginalRTPPAnalyses: False

## ABEIInflation
# whether to utilize adaptive background error inflation (ABEI) in cloud-affected scenes
# as measured by ABI and AHI observations
# OPTIONS: True/False
  ABEInflation: False

## ABEIChannel
# ABI and AHI channel used to determine the inflation factor
# OPTIONS: 8, 9, 10
  ABEIChannel: 8

## benchmarkObservations
# base set of observation types assimilated in all experiments
  benchmarkObservations:
# anchor
  - aircraft
  - gnssroref
  - satwind
#TODO: add satwnd, used in ColdStart and will not break WarmStart
# - satwnd
  - sfc
  - sondes
# MW satellite-based
  - amsua_aqua
  - amsua_metop-a
  - amsua_metop-b
  - amsua_n15
  - amsua_n18
  - amsua_n19

## experimentalObservations
# observation types assimilated in variational application instances
# in addition to the benchmarkObservations
# OPTIONS: see list below
# Abbreviations:
#   clr == clear-sky
#   cld == cloudy-sky
  experimentalObservations: [
# IR satellite-based
#    abi_g16,
#    ahi_himawari8,
#    abi-clr_g16,
#    ahi-clr_himawari8,
# MW satellite-based
# TODO: add scene-dependent ObsErrors to amsua-cld_* ObsSpaces
# TODO: combine amsua_* and amsua-cld_* similar to jedi-gdas
#    amsua-cld_aqua,
#    amsua-cld_metop-a,
#    amsua-cld_metop-b,
#    amsua-cld_n15,
#    amsua-cld_n18,
#    amsua-cld_n19,
  ]

## nObsIndent
# number of spaces to precede members of the 'observations' list in the JEDI YAML
  nObsIndent: 2

####################################################################################################
job:
## *AccountNumber
# OPTIONS: NMMM0015, NMMM0043
#Note: NMMM0043 is not available on casper

## *QueueName
# Cheyenne Options: economy, regular, premium
# Casper Options: casper@casper-pbs

# CP*: used for all critical path jobs, single or multi-node, multi-processor only
  CPAccountNumber: NMMM0043
  CPQueueName: regular

# NCP*: used non-critical path jobs, single or multi-node, multi-processor only
  NCPAccountNumber: NMMM0043
  NCPQueueName: economy

# EnsMeanBG*: settings for ensemble mean BG calculation, useful when it becomes time-critical
  EnsMeanBGAccountNumber: NMMM0043
  EnsMeanBGQueueName: economy

# SingleProc*: used for single-processor jobs, both critical and non-critical paths
# IMPORTANT: must NOT be executed on login node to comply with CISL requirements
  #SingleProcAccountNumber: NMMM0043
  #SingleProcQueueName: share
  SingleProcAccountNumber: NMMM0015
  SingleProcQueueName: "casper@casper-pbs"

## *Retry
# various retry counts for different types of tasks
  InitializationRetry: '2*PT30S'
  VariationalRetry: '2*PT30S'
  EnsOfVariationalRetry: '1*PT30S'
  CyclingFCRetry: '2*PT30S'
  RTPPInflationRetry: '2*PT30S'
  HofXRetry: '2*PT30S'
  VerifyObsRetry: '1*PT30S'
  VerifyModelRetry: '1*PT30S'
